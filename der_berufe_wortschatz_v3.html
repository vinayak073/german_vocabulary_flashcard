
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Berufe Flashcards â€” Voice Picker + Status</title>
<style>
:root { --gap: 10px; --card-pad: 12px; }
* { box-sizing: border-box; }
body { font-family: Arial, Helvetica, sans-serif; margin: 0; padding: 16px; }
h1 { margin: 0 0 12px 0; font-size: 22px; }
.controls { display:grid; grid-template-columns: 1fr 1fr; gap:10px; align-items:center; margin-bottom: 12px; }
.controls > * { min-width: 0; }
select, input, button { padding:8px; font-size: 14px; }
.grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: var(--gap); }
.card { border: 1px solid #000; padding: var(--card-pad); border-radius: 8px; }
.topline { display:flex; align-items:center; gap:8px; }
.badge { border:1px solid #000; border-radius:6px; padding:2px 6px; font-size:12px; }
.word { font-weight:700; font-size:20px; }
.meta { font-size:12px; opacity:0.8; margin-top:4px; }
.row { display:flex; gap:8px; margin-top:8px; }
.row button { flex:1; padding:8px; font-size:13px; }
.sep { height:1px; background:#ddd; margin:8px 0; }
.hidden-en .en, .hidden-de .de { filter: blur(6px); }
footer { margin-top: 14px; font-size: 12px; opacity: 0.7; }

.status { display:flex; align-items:center; gap:8px; font-size:13px; }
.light { width:12px; height:12px; border-radius:50%; background:#999; box-shadow: 0 0 0 2px #0001 inset; }
.light.loading { background:#f39c12; }  /* amber */
.light.ready { background:#2ecc71; }   /* green */
.light.speaking { background:#e74c3c; animation: pulse 1s infinite; } /* red */
@keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(231,76,60,.6); } 100% { box-shadow: 0 0 0 10px rgba(231,76,60,0); } }

@media print {
  .controls, footer { display:none; }
  body { padding: 0; }
  .grid { grid-template-columns: repeat(3, 1fr); }
}
</style>
</head>
<body>
<h1>der Beruf â€” die Berufe â€¢ Voice picker + status</h1>

<div class="controls">
  <div class="status"><div id="light" class="light loading"></div><div id="statusText">Loading voicesâ€¦</div></div>
  <div style="text-align:right;"><button id="print">Print</button></div>

  <input id="search" type="search" placeholder="Search (de/en)">
  <select id="genderFilter">
    <option value="">All</option>
    <option value="der">der (m)</option>
    <option value="die">die (f/pl)</option>
    <option value="das">das (n)</option>
  </select>

  <div>
    <label>German voice:</label>
    <select id="deVoice"></select>
  </div>
  <div>
    <label>English voice:</label>
    <select id="enVoice"></select>
  </div>

  <div><button id="toggleDE">Hide/Show German</button></div>
  <div><button id="toggleEN">Hide/Show English</button></div>

  <div><button id="shuffle">Shuffle</button></div>
  <div><button id="testDe">Test ðŸ‡©ðŸ‡ª</button></div>
  <div><button id="testEn">Test ðŸ‡¬ðŸ‡§</button></div>
</div>

<div id="grid" class="grid"></div>

<footer>
  Works offline (Web Speech API). Use the voice pickers above. Choices are saved on this device.
</footer>

<script>
const DATA = [["der", "Arzt", "Ã„rzte", "doctor (male)"], ["die", "Ã„rztin", "Ã„rztinnen", "doctor (female)"], ["der", "Lehrer", "Lehrer", "teacher (male)"], ["die", "Lehrerin", "Lehrerinnen", "teacher (female)"], ["der", "Ingenieur", "Ingenieure", "engineer (male)"], ["die", "Ingenieurin", "Ingenieurinnen", "engineer (female)"], ["der", "Programmierer", "Programmierer", "programmer (male)"], ["die", "Programmiererin", "Programmiererinnen", "programmer (female)"], ["der", "Pilot", "Piloten", "pilot (male)"], ["die", "Pilotin", "Pilotinnen", "pilot (female)"], ["der", "Fotograf", "Fotografen", "photographer (male)"], ["die", "Fotografin", "Fotografinnen", "photographer (female)"], ["der", "Schauspieler", "Schauspieler", "actor"], ["die", "Schauspielerin", "Schauspielerinnen", "actress"], ["der", "Musiker", "Musiker", "musician (male)"], ["die", "Musikerin", "Musikerinnen", "musician (female)"], ["der", "Busfahrer", "Busfahrer", "bus driver (male)"], ["die", "Busfahrerin", "Busfahrerinnen", "bus driver (female)"], ["der", "VerkÃ¤ufer", "VerkÃ¤ufer", "salesperson (male)"], ["die", "VerkÃ¤uferin", "VerkÃ¤uferinnen", "salesperson (female)"], ["der", "Polizist", "Polizisten", "policeman"], ["die", "Polizistin", "Polizistinnen", "policewoman"], ["der", "Politiker", "Politiker", "politician (male)"], ["die", "Politikerin", "Politikerinnen", "politician (female)"], ["der", "Handwerker", "Handwerker", "craftsperson (male)"], ["die", "Handwerkerin", "Handwerkerinnen", "craftsperson (female)"], ["der", "Manager", "Manager", "manager (male)"], ["die", "Managerin", "Managerinnen", "manager (female)"], ["der", "Journalist", "Journalisten", "journalist (male)"], ["die", "Journalistin", "Journalistinnen", "journalist (female)"], ["der", "Buchhalter", "Buchhalter", "accountant (male)"], ["die", "Buchhalterin", "Buchhalterinnen", "accountant (female)"], ["der", "KÃ¼nstler", "KÃ¼nstler", "artist (male)"], ["die", "KÃ¼nstlerin", "KÃ¼nstlerinnen", "artist (female)"], ["der", "Kanzler", "Kanzler", "chancellor (male)"], ["die", "Kanzlerin", "Kanzlerinnen", "chancellor (female)"], ["der", "Berater", "Berater", "consultant (male)"], ["die", "Beraterin", "Beraterinnen", "consultant (female)"], ["der", "Richter", "Richter", "judge (male)"], ["die", "Richterin", "Richterinnen", "judge (female)"], ["der", "Kellner", "Kellner", "waiter"], ["die", "Kellnerin", "Kellnerinnen", "waitress"], ["der", "Dolmetscher", "Dolmetscher", "interpreter (male)"], ["die", "Dolmetscherin", "Dolmetscherinnen", "interpreter (female)"], ["der", "Ãœbersetzer", "Ãœbersetzer", "translator (male)"], ["die", "Ãœbersetzerin", "Ãœbersetzerinnen", "translator (female)"], ["der", "Mechaniker", "Mechaniker", "mechanic (male)"], ["die", "Mechanikerin", "Mechanikerinnen", "mechanic (female)"], ["der", "Techniker", "Techniker", "technician (male)"], ["die", "Technikerin", "Technikerinnen", "technician (female)"], ["der", "Elektriker", "Elektriker", "electrician (male)"], ["die", "Elektrikerin", "Elektrikerinnen", "electrician (female)"], ["der", "Schriftsteller", "Schriftsteller", "writer (male)"], ["die", "Schriftstellerin", "Schriftstellerinnen", "writer (female)"], ["der", "TÃ¤nzer", "TÃ¤nzer", "dancer (male)"], ["die", "TÃ¤nzerin", "TÃ¤nzerinnen", "dancer (female)"], ["der", "Architekt", "Architekten", "architect (male)"], ["die", "Architektin", "Architektinnen", "architect (female)"], ["der", "Hausmeister", "Hausmeister", "caretaker/janitor (male)"], ["die", "Hausmeisterin", "Hausmeisterinnen", "caretaker/janitor (female)"], ["der", "Trainer", "Trainer", "coach/trainer (male)"], ["die", "Trainerin", "Trainerinnen", "coach/trainer (female)"], ["der", "BÃ¤cker", "BÃ¤cker", "baker (male)"], ["die", "BÃ¤ckerin", "BÃ¤ckerinnen", "baker (female)"], ["der", "Chef", "Chefs", "boss (male)"], ["die", "Chefin", "Chefinnen", "boss (female)"], ["der", "Makler", "Makler", "broker/agent (male)"], ["die", "Maklerin", "Maklerinnen", "broker/agent (female)"], ["der", "SekretÃ¤r", "SekretÃ¤re", "secretary (male)"], ["die", "SekretÃ¤rin", "SekretÃ¤rinnen", "secretary (female)"], ["der", "Friseur", "Friseure", "hairdresser (male)"], ["die", "Friseurin", "Friseurinnen", "hairdresser (female)"], ["der", "Kassierer", "Kassierer", "cashier (male)"], ["die", "Kassiererin", "Kassiererinnen", "cashier (female)"], ["der", "Schneider", "Schneider", "tailor (male)"], ["die", "Schneiderin", "Schneiderinnen", "tailor (female)"], ["der", "Postbote", "Postboten", "postman"], ["die", "Postbotin", "Postbotinnen", "postwoman"], ["der", "Apotheker", "Apotheker", "pharmacist (male)"], ["die", "Apothekerin", "Apothekerinnen", "pharmacist (female)"], ["der", "Erzieher", "Erzieher", "kindergarten teacher (male)"], ["die", "Erzieherin", "Erzieherinnen", "kindergarten teacher (female)"], ["der", "SÃ¤nger", "SÃ¤nger", "singer (male)"], ["die", "SÃ¤ngerin", "SÃ¤ngerinnen", "singer (female)"], ["der", "Student", "Studenten", "university student (male)"], ["die", "Studentin", "Studentinnen", "university student (female)"], ["der", "SchÃ¼ler", "SchÃ¼ler", "school student (male)"], ["die", "SchÃ¼lerin", "SchÃ¼lerinnen", "school student (female)"], ["der", "Hausmann", "HausmÃ¤nner", "househusband"], ["die", "Hausfrau", "Hausfrauen", "housewife"], ["die", "Krankenschwester", "Krankenschwestern", "nurse (female)"], ["der", "Krankenpfleger", "Krankenpfleger", "nurse (male)"], ["der", "Feuerwehrmann", "FeuerwehrmÃ¤nner", "firefighter (male)"], ["die", "Feuerwehrfrau", "Feuerwehrfrauen", "firefighter (female)"], ["der", "Angestellte", "Angestellten", "employee (male)"], ["die", "Angestellte", "Angestellten", "employee (female)"], ["der", "Anwalt", "AnwÃ¤lte", "lawyer (male)"], ["die", "AnwÃ¤ltin", "AnwÃ¤ltinnen", "lawyer (female)"], ["der", "Koch", "KÃ¶che", "cook/chef (male)"], ["die", "KÃ¶chin", "KÃ¶chinnen", "cook/chef (female)"], ["der", "Kaufmann", "KaufmÃ¤nner / Kaufleute", "merchant/businessman"], ["die", "Kauffrau", "Kauffrauen", "merchant/businesswoman"], ["der", "Bauer", "Bauern", "farmer (male)"], ["die", "BÃ¤uerin", "BÃ¤uerinnen", "farmer (female)"], ["der", "Bauarbeiter", "Bauarbeiter", "construction worker (male)"], ["die", "Bauarbeiterin", "Bauarbeiterinnen", "construction worker (female)"]];

let VOICES = [];
const light = document.getElementById('light');
const statusText = document.getElementById('statusText');
const deSel = document.getElementById('deVoice');
const enSel = document.getElementById('enVoice');

function setLight(state, text) {
  light.className = 'light ' + state;
  if (text) statusText.textContent = text;
}

function savePrefs() {
  localStorage.setItem('deVoice', deSel.value || '');
  localStorage.setItem('enVoice', enSel.value || '');
}

function loadPrefs() {
  return {
    de: localStorage.getItem('deVoice') || '',
    en: localStorage.getItem('enVoice') || ''
  };
}

function loadVoices() {
  return new Promise(resolve => {
    const got = speechSynthesis.getVoices();
    if (got.length) { VOICES = got; resolve(got); }
    else {
      speechSynthesis.onvoiceschanged = () => { VOICES = speechSynthesis.getVoices(); resolve(VOICES); };
    }
  });
}

function fillVoiceSelects() {
  const prefs = loadPrefs();
  const mkOpt = (v)=> `<option value="${v.name}|${v.lang}">${v.name} [${v.lang}]</option>`;
  const de = VOICES.filter(v=>/^de(-|$)/i.test(v.lang));
  const en = VOICES.filter(v=>/^en(-|$)/i.test(v.lang));

  deSel.innerHTML = de.map(mkOpt).join('') || '<option>No German voices found</option>';
  enSel.innerHTML = en.map(mkOpt).join('') || '<option>No English voices found</option>';

  if (prefs.de && [...deSel.options].some(o=>o.value===prefs.de)) deSel.value = prefs.de;
  else if (de.length) {
    const pref = de.find(v=>/google|deutsch/i.test(v.name)) || de[0];
    deSel.value = pref.name + '|' + pref.lang;
  }

  if (prefs.en && [...enSel.options].some(o=>o.value===prefs.en)) enSel.value = prefs.en;
  else if (en.length) {
    const pref = en.find(v=>/google|natural|neural/i.test(v.name)) || en[0];
    enSel.value = pref.name + '|' + pref.lang;
  }
}

function pickVoiceFromSelect(selectEl) {
  const val = selectEl.value;
  const [name, lang] = (val || '|').split('|');
  return VOICES.find(v => v.name === name && v.lang === lang) || null;
}

function speak(text, selectEl, fallbackLang) {
  const u = new SpeechSynthesisUtterance(text);
  const voice = pickVoiceFromSelect(selectEl);
  if (voice) { u.voice = voice; u.lang = voice.lang; } else { u.lang = fallbackLang || 'de-DE'; }
  setLight('speaking', 'Speakingâ€¦');
  u.onend = ()=> setLight('ready', 'Ready');
  u.onerror = ()=> setLight('ready', 'Ready');
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

function init() {
  setLight('loading', 'Loading voicesâ€¦');
  loadVoices().then(()=>{
    fillVoiceSelects();
    savePrefs();
    setLight('ready', 'Ready');
  });
}

deSel.addEventListener('change', savePrefs);
enSel.addEventListener('change', savePrefs);

document.getElementById('testDe').addEventListener('click', ()=> speak('Guten Tag! der Beruf, die Berufe.', deSel, 'de-DE'));
document.getElementById('testEn').addEventListener('click', ()=> speak('Hello there! Occupation, occupations.', enSel, 'en-US'));

// UI â€” search/filter/shuffle/print
let hiddenDE = false, hiddenEN = false;
let current = [...DATA];

function cardTemplate(o, idx) {
  const article = o[0], singular = o[1], plural = o[2], english = o[3];
  const pluralPhrase = (plural.startsWith('der ')||plural.startsWith('die ')||plural.startsWith('das ')) ? plural : ('die ' + plural);
  return `
  <div class="card" data-idx="${idx}" data-article="${article}">
    <div class="topline"><span class="badge">${article}</span><span class="word de">${singular}</span></div>
    <div class="meta de">Plural: ${plural}</div>
    <div class="row">
      <button onclick="speak('${article} ${singular}', deSel, 'de-DE')">ðŸ”Š DE (sing.)</button>
      <button onclick="speak('${english}', enSel, 'en-US')">ðŸ”Š EN</button>
    </div>
    <div class="sep"></div>
    <div class="word en">${english}</div>
    <div class="meta en">${article} ${singular} â€” ${plural}</div>
    <div class="row">
      <button onclick="speak('${pluralPhrase}', deSel, 'de-DE')">ðŸ”Š DE (plural)</button>
      <button onclick="speak('${english}', enSel, 'en-GB')">ðŸ”Š EN (alt)</button>
    </div>
  </div>`;
}

function render(list) {
  const grid = document.getElementById('grid');
  grid.innerHTML = list.map(cardTemplate).join('');
  grid.classList.toggle('hidden-de', hiddenDE);
  grid.classList.toggle('hidden-en', hiddenEN);
}

function matches(row, q) {
  const s = q.toLowerCase();
  return row[0].toLowerCase().includes(s) ||
         row[1].toLowerCase().includes(s) ||
         row[2].toLowerCase().includes(s) ||
         row[3].toLowerCase().includes(s);
}

document.getElementById('search').addEventListener('input', (e)=>{
  const q = e.target.value.trim();
  const gender = document.getElementById('genderFilter').value;
  current = DATA.filter(r => (!q || matches(r,q)) && (!gender || r[0]===gender));
  render(current);
});
document.getElementById('genderFilter').addEventListener('change', (e)=>{
  const q = document.getElementById('search').value.trim();
  const gender = e.target.value;
  current = DATA.filter(r => (!q || matches(r,q)) && (!gender || r[0]===gender));
  render(current);
});
document.getElementById('toggleDE').addEventListener('click', ()=>{ hiddenDE = !hiddenDE; render(current); });
document.getElementById('toggleEN').addEventListener('click', ()=>{ hiddenEN = !hiddenEN; render(current); });
document.getElementById('shuffle').addEventListener('click', ()=>{
  for (let i=current.length-1;i>0;--i) { const j=Math.floor(Math.random()*(i+1)); [current[i],current[j]]=[current[j],current[i]]; }
  render(current);
});
document.getElementById('print').addEventListener('click', ()=> window.print());

document.addEventListener('click', ()=> init(), { once: true });
render(current);
</script>
</body>
</html>
